version: '3'

tasks:
  bootstrap:
    internal: true
    cmds:
      - . script/bootstrap
    dir: backend
  lint:
    desc: "Lints /backend using black + pylint."
    deps: [bootstrap]
    cmds:
      - black . --check
      - pylint
    dir: backend
  lintfix:
    desc: "Lints and fixes /backend using black + pylint."
    deps: [bootstrap]
    cmds:
      - black .
      - pylint rotini
    dir: backend
  start:
    desc: "Starts the backend application."
    deps: [bootstrap]
    cmds:
      - source ../.venv/bin/activate && source ../.env && python -m uvicorn main:app
    dir: backend/rotini
  migrate:
    desc: "Applies migrations. Usage: be:migrate -- <up|down>"
    deps: [bootstrap]
    cmds:
      - source ../../.venv/bin/activate && source ../../.env && python migrate.py {{.CLI_ARGS}}
    dir: backend/rotini/migrations
  lock-deps:
    desc: "Locks production and development dependencies"
    deps: [bootstrap]
    cmds:
      - source .venv/bin/activate && . script/requirements-lock
    dir: backend

